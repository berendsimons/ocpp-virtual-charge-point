<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OCPP VCP Dashboard</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #0f1419;
      color: #e7e9ea;
      min-height: 100vh;
    }

    .header {
      background: #1a1f26;
      border-bottom: 1px solid #2f3336;
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 {
      font-size: 20px;
      font-weight: 600;
      color: #fff;
    }

    .status-bar {
      display: flex;
      gap: 24px;
      font-size: 14px;
    }

    .status-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #00ba7c;
    }

    .status-dot.offline {
      background: #f4212e;
    }

    .container {
      display: grid;
      grid-template-columns: 320px 1fr;
      min-height: calc(100vh - 65px);
    }

    .sidebar {
      background: #16181c;
      border-right: 1px solid #2f3336;
      padding: 16px;
      overflow-y: auto;
    }

    .main {
      padding: 24px;
      overflow-y: auto;
    }

    .section {
      margin-bottom: 24px;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      color: #71767b;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 12px;
    }

    .card {
      background: #1a1f26;
      border: 1px solid #2f3336;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .card:hover {
      border-color: #3b82f6;
    }

    .card.selected {
      border-color: #3b82f6;
      background: #1e2731;
    }

    .charger-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .charger-id {
      font-weight: 600;
      font-size: 14px;
      color: #fff;
    }

    .charger-status {
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 12px;
      background: #2f3336;
    }

    .charger-status.connected {
      background: #00ba7c22;
      color: #00ba7c;
    }

    .charger-status.disconnected {
      background: #f4212e22;
      color: #f4212e;
    }

    .charger-info {
      font-size: 12px;
      color: #71767b;
    }

    .connectors {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .connector {
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 500;
    }

    .connector.Available { background: #00ba7c33; color: #00ba7c; }
    .connector.Charging { background: #3b82f633; color: #3b82f6; }
    .connector.Preparing { background: #f59e0b33; color: #f59e0b; }
    .connector.Finishing { background: #8b5cf633; color: #8b5cf6; }
    .connector.Reserved { background: #ec489933; color: #ec4899; }
    .connector.Unavailable { background: #6b728033; color: #9ca3af; }
    .connector.Faulted { background: #f4212e33; color: #f4212e; }
    .connector.SuspendedEV { background: #f59e0b33; color: #f59e0b; }
    .connector.SuspendedEVSE { background: #f59e0b33; color: #f59e0b; }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #3b82f6;
      color: #fff;
    }

    .btn-primary:hover {
      background: #2563eb;
    }

    .btn-secondary {
      background: #2f3336;
      color: #e7e9ea;
    }

    .btn-secondary:hover {
      background: #3a3f44;
    }

    .btn-danger {
      background: #f4212e;
      color: #fff;
    }

    .btn-danger:hover {
      background: #dc1e28;
    }

    .btn-success {
      background: #00ba7c;
      color: #fff;
    }

    .btn-success:hover {
      background: #00a36c;
    }

    .btn-sm {
      padding: 4px 12px;
      font-size: 12px;
    }

    .form-group {
      margin-bottom: 12px;
    }

    .form-label {
      display: block;
      font-size: 12px;
      color: #71767b;
      margin-bottom: 4px;
    }

    .form-input {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #2f3336;
      border-radius: 8px;
      background: #0f1419;
      color: #e7e9ea;
      font-size: 14px;
    }

    .form-input:focus {
      outline: none;
      border-color: #3b82f6;
    }

    .form-select {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #2f3336;
      border-radius: 8px;
      background: #0f1419;
      color: #e7e9ea;
      font-size: 14px;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .panel {
      background: #1a1f26;
      border: 1px solid #2f3336;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .panel-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 16px;
      color: #fff;
    }

    .charger-list {
      max-height: calc(100vh - 400px);
      overflow-y: auto;
    }

    .checkbox-wrapper {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .checkbox-wrapper input[type="checkbox"] {
      width: 16px;
      height: 16px;
      cursor: pointer;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: #1a1f26;
      border: 1px solid #2f3336;
      border-radius: 12px;
      padding: 16px;
      text-align: center;
    }

    .stat-value {
      font-size: 32px;
      font-weight: 700;
      color: #3b82f6;
    }

    .stat-label {
      font-size: 12px;
      color: #71767b;
      margin-top: 4px;
    }

    .tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 16px;
      border-bottom: 1px solid #2f3336;
      padding-bottom: 8px;
    }

    .tab {
      padding: 8px 16px;
      border: none;
      background: none;
      color: #71767b;
      font-size: 14px;
      cursor: pointer;
      border-radius: 8px;
    }

    .tab:hover {
      background: #2f3336;
      color: #e7e9ea;
    }

    .tab.active {
      background: #3b82f6;
      color: #fff;
    }

    .bulk-selection {
      background: #1e2731;
      border: 1px solid #3b82f6;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .slider-group {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .slider {
      width: 200px;
      height: 6px;
      -webkit-appearance: none;
      background: #2f3336;
      border-radius: 3px;
      outline: none;
    }

    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #3b82f6;
      cursor: pointer;
    }

    .slider-value {
      min-width: 60px;
      text-align: right;
      font-weight: 600;
    }

    .ws-url-form {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }

    .ws-url-form input {
      flex: 1;
    }

    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 14px;
      z-index: 1000;
      animation: slideIn 0.3s ease;
    }

    .toast.success {
      background: #00ba7c;
      color: #fff;
    }

    .toast.error {
      background: #f4212e;
      color: #fff;
    }

    @keyframes slideIn {
      from {
        transform: translateY(100%);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .connector-detail {
      background: #16181c;
      border-radius: 8px;
      padding: 12px;
      margin-top: 8px;
    }

    .connector-detail-row {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      padding: 4px 0;
    }

    .connector-detail-label {
      color: #71767b;
    }

    .connector-detail-value {
      color: #e7e9ea;
      font-weight: 500;
    }

    .empty-state {
      text-align: center;
      padding: 48px;
      color: #71767b;
    }

    .empty-state p {
      margin-bottom: 16px;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>OCPP Virtual Charge Point Dashboard</h1>
    <div class="status-bar">
      <div class="status-item">
        <span class="status-dot" id="statusDot"></span>
        <span id="connectionStatus">Loading...</span>
      </div>
      <div class="status-item">
        <span id="chargerCount">0</span> chargers
      </div>
    </div>
  </div>

  <div class="container">
    <div class="sidebar">
      <div class="section">
        <div class="section-title">WebSocket URL</div>
        <div class="ws-url-form">
          <input type="text" class="form-input" id="wsUrl" placeholder="ws://...">
          <button class="btn btn-secondary btn-sm" onclick="setWsUrl()">Set</button>
        </div>
      </div>

      <div class="section">
        <div class="section-title">Chargers</div>
        <div class="actions" style="margin-bottom: 12px;">
          <button class="btn btn-primary btn-sm" onclick="showAddCharger()">+ Add</button>
          <button class="btn btn-secondary btn-sm" onclick="showGenerateChargers()">Generate</button>
          <button class="btn btn-success btn-sm" onclick="connectAll()">Connect All</button>
        </div>
        <div class="checkbox-wrapper">
          <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
          <label for="selectAll">Select All</label>
        </div>
        <div class="charger-list" id="chargerList">
          <!-- Chargers will be populated here -->
        </div>
      </div>
    </div>

    <div class="main">
      <div id="bulkSelection" class="bulk-selection" style="display: none;">
        <span><strong id="selectedCount">0</strong> chargers selected</span>
        <div class="actions">
          <button class="btn btn-secondary btn-sm" onclick="clearSelection()">Clear</button>
        </div>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="totalChargers">0</div>
          <div class="stat-label">Total Chargers</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="connectedChargers">0</div>
          <div class="stat-label">Connected</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="chargingConnectors">0</div>
          <div class="stat-label">Charging</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="totalPower">0 kW</div>
          <div class="stat-label">Total Power</div>
        </div>
      </div>

      <div class="tabs">
        <button class="tab active" onclick="showTab('bulk')">Bulk Actions</button>
        <button class="tab" onclick="showTab('add')">Add Charger</button>
        <button class="tab" onclick="showTab('generate')">Generate Chargers</button>
      </div>

      <div id="tab-bulk" class="panel">
        <div class="panel-title">Bulk Connector Status</div>
        <div class="form-row" style="margin-bottom: 16px;">
          <div class="form-group">
            <label class="form-label">Connector</label>
            <select class="form-select" id="bulkConnectorId">
              <option value="all">All Connectors</option>
              <option value="1">Connector 1</option>
              <option value="2">Connector 2</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Status</label>
            <select class="form-select" id="bulkStatus">
              <option value="Available">Available</option>
              <option value="Preparing">Preparing</option>
              <option value="Charging">Charging</option>
              <option value="SuspendedEV">SuspendedEV</option>
              <option value="SuspendedEVSE">SuspendedEVSE</option>
              <option value="Finishing">Finishing</option>
              <option value="Reserved">Reserved</option>
              <option value="Unavailable">Unavailable</option>
              <option value="Faulted">Faulted</option>
            </select>
          </div>
        </div>
        <button class="btn btn-primary" onclick="bulkSetStatus()">Apply Status to Selected</button>

        <div class="panel-title" style="margin-top: 24px;">Bulk Charging Current (Simulation)</div>
        <div class="slider-group" style="margin-bottom: 16px;">
          <label class="form-label" style="min-width: 100px;">Current:</label>
          <input type="range" class="slider" id="bulkCurrent" min="0" max="32" value="16" oninput="updateCurrentDisplay()">
          <span class="slider-value" id="currentDisplay">16 A</span>
        </div>
        <button class="btn btn-primary" onclick="bulkSetCurrent()">Apply Current to Selected</button>

        <div class="panel-title" style="margin-top: 24px;">Bulk Configuration</div>
        <div class="form-row" style="margin-bottom: 16px;">
          <div class="form-group">
            <label class="form-label">Configuration Key</label>
            <select class="form-select" id="configKey">
              <option value="HeartbeatInterval">HeartbeatInterval</option>
              <option value="MeterValueSampleInterval">MeterValueSampleInterval</option>
              <option value="ConnectionTimeOut">ConnectionTimeOut</option>
              <option value="ClockAlignedDataInterval">ClockAlignedDataInterval</option>
              <option value="MeterValuesSampledData">MeterValuesSampledData</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Value</label>
            <input type="text" class="form-input" id="configValue" placeholder="e.g., 60">
          </div>
        </div>
        <button class="btn btn-primary" onclick="bulkSendConfig()">Send Config to Selected</button>
      </div>

      <div id="tab-add" class="panel" style="display: none;">
        <div class="panel-title">Add New Charger</div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Charge Point ID *</label>
            <input type="text" class="form-input" id="addCpId" placeholder="e.g., CHARGER-001">
          </div>
          <div class="form-group">
            <label class="form-label">Serial Number</label>
            <input type="text" class="form-input" id="addSerial" placeholder="Auto-generated if empty">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Vendor</label>
            <input type="text" class="form-input" id="addVendor" placeholder="VirtualCharger" value="VirtualCharger">
          </div>
          <div class="form-group">
            <label class="form-label">Model</label>
            <input type="text" class="form-input" id="addModel" placeholder="VCP-1" value="VCP-1">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Firmware Version</label>
            <input type="text" class="form-input" id="addFirmware" placeholder="1.0.0" value="1.0.0">
          </div>
          <div class="form-group">
            <label class="form-label">Number of Connectors</label>
            <input type="number" class="form-input" id="addConnectors" placeholder="1" value="1" min="1" max="10">
          </div>
        </div>
        <button class="btn btn-primary" onclick="addCharger()">Add Charger</button>
      </div>

      <div id="tab-generate" class="panel" style="display: none;">
        <div class="panel-title">Generate Multiple Chargers</div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">ID Prefix *</label>
            <input type="text" class="form-input" id="genPrefix" placeholder="e.g., VCP">
          </div>
          <div class="form-group">
            <label class="form-label">Count *</label>
            <input type="number" class="form-input" id="genCount" placeholder="10" value="10" min="1" max="100">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Vendor</label>
            <input type="text" class="form-input" id="genVendor" placeholder="VirtualCharger" value="VirtualCharger">
          </div>
          <div class="form-group">
            <label class="form-label">Model</label>
            <input type="text" class="form-input" id="genModel" placeholder="VCP-1" value="VCP-1">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Firmware Version</label>
            <input type="text" class="form-input" id="genFirmware" placeholder="1.0.0" value="1.0.0">
          </div>
          <div class="form-group">
            <label class="form-label">Connectors per Charger</label>
            <input type="number" class="form-input" id="genConnectors" placeholder="2" value="2" min="1" max="10">
          </div>
        </div>
        <p style="color: #71767b; font-size: 12px; margin-bottom: 16px;">
          This will create chargers with IDs: {prefix}-001, {prefix}-002, etc.
        </p>
        <button class="btn btn-primary" onclick="generateChargers()">Generate Chargers</button>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = '/api';
    let chargers = [];
    let selectedChargers = new Set();
    let refreshInterval;

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      loadChargers();
      refreshInterval = setInterval(loadChargers, 5000);
    });

    // API calls
    async function api(endpoint, options = {}) {
      const response = await fetch(`${API_BASE}${endpoint}`, {
        ...options,
        headers: {
          'Content-Type': 'application/json',
          ...options.headers,
        },
      });
      return response.json();
    }

    async function loadChargers() {
      try {
        const status = await api('/status');
        document.getElementById('wsUrl').value = status.wsUrl;
        document.getElementById('connectionStatus').textContent = `${status.connectedChargers}/${status.totalChargers} online`;
        document.getElementById('statusDot').className = status.connectedChargers > 0 ? 'status-dot' : 'status-dot offline';

        chargers = await api('/chargers');
        renderChargerList();
        updateStats();
      } catch (err) {
        console.error('Failed to load chargers:', err);
        showToast('Failed to load chargers', 'error');
      }
    }

    function renderChargerList() {
      const list = document.getElementById('chargerList');

      if (chargers.length === 0) {
        list.innerHTML = `
          <div class="empty-state">
            <p>No chargers configured</p>
            <button class="btn btn-primary btn-sm" onclick="showTab('add')">Add your first charger</button>
          </div>
        `;
        return;
      }

      list.innerHTML = chargers.map(charger => `
        <div class="card ${selectedChargers.has(charger.cpId) ? 'selected' : ''}" onclick="toggleChargerSelection('${charger.cpId}')">
          <div class="charger-header">
            <div style="display: flex; align-items: center; gap: 8px;">
              <input type="checkbox" ${selectedChargers.has(charger.cpId) ? 'checked' : ''} onclick="event.stopPropagation(); toggleChargerSelection('${charger.cpId}')">
              <span class="charger-id">${charger.cpId}</span>
            </div>
            <span class="charger-status ${charger.connected ? 'connected' : 'disconnected'}">
              ${charger.connected ? 'Online' : 'Offline'}
            </span>
          </div>
          <div class="charger-info">${charger.config.vendor} ${charger.config.model}</div>
          <div class="connectors">
            ${charger.connectors.map(c => `
              <span class="connector ${c.status}">
                #${c.connectorId}: ${c.status}${c.currentImport > 0 ? ` (${c.currentImport}A)` : ''}
              </span>
            `).join('')}
          </div>
          <div class="actions" style="margin-top: 8px;">
            ${!charger.connected ? `
              <button class="btn btn-success btn-sm" onclick="event.stopPropagation(); connectCharger('${charger.cpId}')">Connect</button>
            ` : ''}
            <button class="btn btn-danger btn-sm" onclick="event.stopPropagation(); deleteCharger('${charger.cpId}')">Delete</button>
          </div>
        </div>
      `).join('');
    }

    function updateStats() {
      const total = chargers.length;
      const connected = chargers.filter(c => c.connected).length;
      const charging = chargers.reduce((sum, c) =>
        sum + c.connectors.filter(conn => conn.status === 'Charging').length, 0);
      const totalPower = chargers.reduce((sum, c) =>
        sum + c.connectors.reduce((s, conn) => s + (conn.powerImport || 0), 0), 0);

      document.getElementById('totalChargers').textContent = total;
      document.getElementById('connectedChargers').textContent = connected;
      document.getElementById('chargingConnectors').textContent = charging;
      document.getElementById('totalPower').textContent = (totalPower / 1000).toFixed(1) + ' kW';
      document.getElementById('chargerCount').textContent = total;
    }

    function toggleChargerSelection(cpId) {
      if (selectedChargers.has(cpId)) {
        selectedChargers.delete(cpId);
      } else {
        selectedChargers.add(cpId);
      }
      updateSelectionUI();
      renderChargerList();
    }

    function toggleSelectAll() {
      const selectAll = document.getElementById('selectAll').checked;
      if (selectAll) {
        chargers.forEach(c => selectedChargers.add(c.cpId));
      } else {
        selectedChargers.clear();
      }
      updateSelectionUI();
      renderChargerList();
    }

    function clearSelection() {
      selectedChargers.clear();
      document.getElementById('selectAll').checked = false;
      updateSelectionUI();
      renderChargerList();
    }

    function updateSelectionUI() {
      const count = selectedChargers.size;
      document.getElementById('selectedCount').textContent = count;
      document.getElementById('bulkSelection').style.display = count > 0 ? 'flex' : 'none';
    }

    function showTab(tab) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('[id^="tab-"]').forEach(p => p.style.display = 'none');

      document.querySelector(`.tab[onclick="showTab('${tab}')"]`).classList.add('active');
      document.getElementById(`tab-${tab}`).style.display = 'block';
    }

    function showAddCharger() { showTab('add'); }
    function showGenerateChargers() { showTab('generate'); }

    async function setWsUrl() {
      const wsUrl = document.getElementById('wsUrl').value;
      await api('/settings/ws-url', {
        method: 'POST',
        body: JSON.stringify({ wsUrl }),
      });
      showToast('WebSocket URL updated', 'success');
    }

    async function connectCharger(cpId) {
      showToast(`Connecting ${cpId}...`, 'success');
      const result = await api(`/chargers/${cpId}/connect`, { method: 'POST' });
      if (result.success) {
        showToast(`${cpId} connected`, 'success');
      } else {
        showToast(`Failed to connect ${cpId}`, 'error');
      }
      loadChargers();
    }

    async function connectAll() {
      showToast('Connecting all chargers...', 'success');
      const result = await api('/chargers/connect-all', { method: 'POST' });
      showToast(`Connected ${result.success} chargers, ${result.failed} failed`, 'success');
      loadChargers();
    }

    async function deleteCharger(cpId) {
      if (!confirm(`Delete charger ${cpId}?`)) return;
      await api(`/chargers/${cpId}`, { method: 'DELETE' });
      selectedChargers.delete(cpId);
      showToast(`${cpId} deleted`, 'success');
      loadChargers();
    }

    async function addCharger() {
      const cpId = document.getElementById('addCpId').value;
      if (!cpId) {
        showToast('Charge Point ID is required', 'error');
        return;
      }

      const result = await api('/chargers', {
        method: 'POST',
        body: JSON.stringify({
          cpId,
          serialNumber: document.getElementById('addSerial').value || cpId,
          vendor: document.getElementById('addVendor').value,
          model: document.getElementById('addModel').value,
          firmwareVersion: document.getElementById('addFirmware').value,
          connectors: parseInt(document.getElementById('addConnectors').value, 10),
        }),
      });

      if (result.success) {
        showToast(`Charger ${cpId} added`, 'success');
        document.getElementById('addCpId').value = '';
        document.getElementById('addSerial').value = '';
        loadChargers();
      } else {
        showToast(result.error || 'Failed to add charger', 'error');
      }
    }

    async function generateChargers() {
      const prefix = document.getElementById('genPrefix').value;
      const count = parseInt(document.getElementById('genCount').value, 10);

      if (!prefix || !count) {
        showToast('Prefix and count are required', 'error');
        return;
      }

      const result = await api('/chargers/generate', {
        method: 'POST',
        body: JSON.stringify({
          prefix,
          count,
          vendor: document.getElementById('genVendor').value,
          model: document.getElementById('genModel').value,
          firmwareVersion: document.getElementById('genFirmware').value,
          connectors: parseInt(document.getElementById('genConnectors').value, 10),
        }),
      });

      if (result.success) {
        showToast(`Generated ${result.count} chargers`, 'success');
        loadChargers();
      } else {
        showToast(result.error || 'Failed to generate chargers', 'error');
      }
    }

    async function bulkSetStatus() {
      if (selectedChargers.size === 0) {
        showToast('Select at least one charger', 'error');
        return;
      }

      const connectorId = document.getElementById('bulkConnectorId').value;
      const status = document.getElementById('bulkStatus').value;

      const result = await api('/bulk/status', {
        method: 'POST',
        body: JSON.stringify({
          cpIds: Array.from(selectedChargers),
          connectorId: connectorId === 'all' ? 'all' : parseInt(connectorId, 10),
          status,
        }),
      });

      showToast(`Status updated: ${result.success} success, ${result.failed} failed`, 'success');
      loadChargers();
    }

    function updateCurrentDisplay() {
      const value = document.getElementById('bulkCurrent').value;
      document.getElementById('currentDisplay').textContent = `${value} A`;
    }

    async function bulkSetCurrent() {
      if (selectedChargers.size === 0) {
        showToast('Select at least one charger', 'error');
        return;
      }

      const connectorId = document.getElementById('bulkConnectorId').value;
      const currentAmps = parseInt(document.getElementById('bulkCurrent').value, 10);

      const result = await api('/bulk/current', {
        method: 'POST',
        body: JSON.stringify({
          cpIds: Array.from(selectedChargers),
          connectorId: connectorId === 'all' ? 'all' : parseInt(connectorId, 10),
          currentAmps,
        }),
      });

      showToast(`Current updated: ${result.success} success, ${result.failed} failed`, 'success');
      loadChargers();
    }

    async function bulkSendConfig() {
      if (selectedChargers.size === 0) {
        showToast('Select at least one charger', 'error');
        return;
      }

      const key = document.getElementById('configKey').value;
      const value = document.getElementById('configValue').value;

      if (!value) {
        showToast('Configuration value is required', 'error');
        return;
      }

      const result = await api('/bulk/config', {
        method: 'POST',
        body: JSON.stringify({
          cpIds: Array.from(selectedChargers),
          key,
          value,
        }),
      });

      showToast(`Config sent: ${result.success} success, ${result.failed} failed`, 'success');
    }

    function showToast(message, type = 'success') {
      const existing = document.querySelector('.toast');
      if (existing) existing.remove();

      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => toast.remove(), 3000);
    }
  </script>
</body>
</html>
